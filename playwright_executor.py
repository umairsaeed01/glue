# ... existing code ...

# Replace the incorrect call
analysis = analyze_page_with_context(driver, {
    "html_content": html_content,
    "screenshot": snapshots["screenshot"]
})

# ... existing code ... 